[{"path":"index.html","id":"statistical-analysis","chapter":"IMAP-STATS: Statistical Analysis of Microbiome Data","heading":"IMAP-STATS: Statistical Analysis of Microbiome Data","text":"","code":""},{"path":"index.html","id":"welcome-to-the-statistical-analysis-guide-for-microbiome-studies","chapter":"IMAP-STATS: Statistical Analysis of Microbiome Data","heading":"Welcome to the Statistical Analysis Guide for Microbiome Studies","text":"Embarking exploration microbiome statistical analysis, guide aims unravel complexities deciphering data pertaining structure function microbial communities. analytical journey instrumental unraveling nuanced relationships existing microorganisms hosts environments. Join us delve guide, navigating essential steps extract meaningful insights complex world microbiomes.","code":""},{"path":"microbiome-statistical-analysis-steps.html","id":"microbiome-statistical-analysis-steps","chapter":"1 Microbiome Statistical Analysis Steps","heading":"1 Microbiome Statistical Analysis Steps","text":"demonstarte perform statistical tests compare groups. also account confounding variables potential batch effects.","code":""},{"path":"statistical-significance-analysis.html","id":"statistical-significance-analysis","chapter":"3 Statistical Significance Analysis","heading":"3 Statistical Significance Analysis","text":"section delves statistical analysis methods tailored specifically microbiome data. Statistical analysis plays crucial role understanding complex relationships patterns within microbiome datasets, helping researchers uncover significant findings insights microbial community dynamics, composition, responses various environmental factors treatments.","code":"\nknitr::opts_chunk$set(\n  echo  =TRUE,\n  message  =FALSE,\n  warning  =FALSE,\n  cache  =FALSE,\n  fig.path = \"figures\",\n  comment  =NA)\n# Load required packages\nlibrary(phyloseq)\nlibrary(tidyverse)\nlibrary(microbial)\nlibrary(microbiome)\nlibrary(microViz)\n\ncat(\"\\nSaved RData objects\\n\\n\")\nSaved RData objects\nload(\"../imap-data-exploration/data/dataframe_objects.rda\", verbose = T)Loading objects:\n  df_GlobalPatterns\n  df_dietswap\n  df_caporaso\n  df_kostic_crc\nload(\"../imap-data-exploration/data/phyloseq_objects.rda\", verbose = T)Loading objects:\n  ps_GlobalPatterns\n  ps_dietswap\n  ps_caporaso\n  ps_kostic_crc\nload(\"../imap-data-exploration/data/phyloseq_extra_objects.rda\", verbose = T)Loading objects:\n  psextra_clr_dietswap\n  psextra_id_dietswap\n  psextra_log10p_dietswap\nload(\"../imap-data-exploration/data/ps_transformed.rda\", verbose = T)Loading objects:\n  ps_asin\n  ps_identity\n  ps_compositional\n  ps_z_otu\n  ps_z_sample\n  ps_log10\n  ps_log10p\n  ps_clr\n  ps_shift\n  ps_scale\nload(\"../imap-data-exploration/data/bray_distances.rda\", verbose = T)Loading objects:\n  ps_asin_bray_dist\n  ps_compositional_bray_dist\n  ps_z_otu_bray_dist\n  ps_z_sample_bray_dist\n  ps_log10_bray_dist\n  ps_log10p_bray_dist\n  ps_clr_bray_dist\n  ps_shift_bray_dist\n  ps_scale_bray_dist\nload(\"../imap-data-exploration/data/psextra_distances.rda\", verbose = T)Loading objects:\n  psextra_clr_asin_bray_dist\n  psextra_id_asin_bray_dist\n  psextra_log10p_asin_bray_dist\nload(\"../imap-data-exploration/data/reduced_dimension.rda\", verbose = T)Loading objects:\n  pca_asin_bray_metrics\n  mds_asin_bray_metrics\n  pcoa_asin_bray_metrics\n  tsne_asin_bray_metrics\nload(\"../imap-data-exploration/data/phyloseq_raw_rel_psextra_df_objects.rda\", verbose = T)Loading objects:\n  ps_raw\n  ps_rel\n  psextra_raw\n  psextra_rel\n  ps_df"},{"path":"statistical-significance-analysis.html","id":"permanova","chapter":"3 Statistical Significance Analysis","heading":"3.1 Permutational Multivariate Analysis of Variance","text":"PERMANOVA (Permutational Multivariate Analysis Variance) statistical test used assess significance differences groups microbial communities. Particularly suited analyzing multivariate data like microbiome composition, PERMANOVA offers valuable insights different experimental conditions treatments impact microbial community structure.","code":"\nlibrary(microViz) \nlibrary(dplyr) \n\nbray_perm <- psextra_log10p_asin_bray_dist %>%\n  dist_permanova(\n    seed = 1234, # for set.seed to ensure reproducibility of random process\n    n_processes = 1, n_perms = 99, # you should use at least 999!\n    variables = \"bmi_group\"\n  )\n\nperm_get(bray_perm) %>% as.data.frame()           Df  SumOfSqs         R2        F Pr(>F)\nbmi_group   2 0.1233611 0.04544245 5.212833   0.01\nResidual  219 2.5913059 0.95455755       NA     NA\nTotal     221 2.7146670 1.00000000       NA     NA\ninfo_get(bray_perm)psExtra info:\ntax_agg = \"Genus\" tax_trans = \"log10p\" dist_method = \"bray\" "},{"path":"statistical-significance-analysis.html","id":"lda-effect-size","chapter":"3 Statistical Significance Analysis","heading":"3.2 LEfSe: Linear discriminant analysis (LDA) effect size","text":"Linear discriminant analysis effect size (LEfSe) statistical method used biomarker discovery identification differentially abundant features two biological groups.LEfSe combines LDA (Linear Discriminant Analysis) effect size estimation identify microbial taxa features likely explain differences groups.LDA plot","code":"\nif(!dir.create(\"data\")) {dir.create(\"data\")}\n\n# source(\"_microbial_plot.R\")\nlibrary(tidyverse)\nlibrary(microbial)\n\n\n# Nationality\nlda_nat <- ldamarker(ps_raw, group=\"nationality\")\n\np <- lda_nat %>%\nplotLDA(group=c(\"AAM\",\"AFR\"), lda = 4.5) +\n  labs(fill = NULL)\n\n\n# BMI\nlda_bmi <- ldamarker(ps_raw, group=\"bmi_group\")\n\nlda_bmi %>%\nplotLDA(group=c(\"lean\", \"overweight\"), lda = 4.5) +\n  labs(fill = NULL)\nlda_bmi %>%\nplotLDA(group=c(\"lean\", \"obese\"), lda = 4) +\n  labs(fill = NULL)\nlda_bmi %>%\nplotLDA(group=c(\"overweight\", \"obese\"), lda = 4.5) +\n  labs(fill = NULL)"},{"path":"statistical-significance-analysis.html","id":"taxa-prevalence-and-detection","chapter":"3 Statistical Significance Analysis","heading":"3.3 Taxa Prevalence and Detection","text":"Taxa prevalence refers frequency occurrence particular taxonomic unit (e.g., species genus) within given dataset set samples.quantifies often taxon present detected across samples study.High prevalence indicates taxon commonly found across many samplesLow prevalence suggests taxon sporadic rare.Analyzing taxa prevalence can provide insights distribution different microbial taxa.Subsetting core taxa","code":"\nlibrary(phyloseq)\n\n# Min and max sample and taxa sums: These values are useful when setting up some threshholds.\n\ncat(\"Minimum sample sums:\", min(data.frame(sample_sums(ps_raw))), \"\\n\\n\")Minimum sample sums: 1776 \ncat(\"Maximum sample sums:\", max(data.frame(sample_sums(ps_raw))), \"\\n\\n\")Maximum sample sums: 28883 \ncat(\"Minimum taxa sums:\", min(data.frame(taxa_sums(ps_raw))), \"\\n\\n\")Minimum taxa sums: 0 \ncat(\"Maximum taxa sums:\", max(data.frame(taxa_sums(ps_raw))), \"\\n\\n\")Maximum taxa sums: 873314 \nps_prune_sample <- phyloseq::subset_samples(ps_raw, phyloseq::sample_sums(ps_raw) >20000)\nps_prune_taxa <- phyloseq::prune_taxa(phyloseq::taxa_sums(ps_prune_sample) > 0, ps_prune_sample)\nps_core <- microbiome::core(ps_prune_taxa, detection  = 0.01, prevalence = 0.01)\nps_corephyloseq-class experiment-level object\notu_table()   OTU Table:         [ 116 taxa and 18 samples ]\nsample_data() Sample Data:       [ 18 samples by 8 sample variables ]\ntax_table()   Taxonomy Table:    [ 116 taxa by 3 taxonomic ranks ]\nphy_tree()    Phylogenetic Tree: [ 116 tips and 115 internal nodes ]"},{"path":"statistical-significance-analysis.html","id":"permanova","chapter":"3 Statistical Significance Analysis","heading":"3.4 PERMANOVA: Permutation Analysis of Variance","text":"Use PERMANOVA assess significance differences groups based multivariate data. PERMANOVA flexible robust method accounts various data characteristics can provide valuable insights factors driving variation data.","code":"\n## Permanova\n\nlibrary(kableExtra)\nlibrary(tidyverse)\nlibrary(magrittr)\n\nps_prune_sample <- phyloseq::subset_samples(ps_raw, phyloseq::sample_sums(ps_raw) >15000)\nps_prune_taxa <- phyloseq::prune_taxa(phyloseq::taxa_sums(ps_prune_sample) > 0, ps_prune_sample)\nps_core <- microbiome::core(ps_prune_taxa, detection  = 0.01, prevalence = 0.01)\nps_corephyloseq-class experiment-level object\notu_table()   OTU Table:         [ 119 taxa and 76 samples ]\nsample_data() Sample Data:       [ 76 samples by 8 sample variables ]\ntax_table()   Taxonomy Table:    [ 119 taxa by 3 taxonomic ranks ]\nphy_tree()    Phylogenetic Tree: [ 119 tips and 118 internal nodes ]"},{"path":"statistical-significance-analysis.html","id":"population-wise-multivariate-anova","chapter":"3 Statistical Significance Analysis","heading":"3.5 Population-wise multivariate ANOVA","text":"","code":"\nlibrary(vegan)\nlibrary(microbial)\n\nps_raw %>% \nbetatest(group = c(\"nationality\", \"bmi_group\"), distance = \"bray\") %>%\n  set_colnames(c(\"Group\", \"Df\", \"SumsOfSqs\", \"MeanSqs\", \"FModel\", \"R2\", \"Pvalue\")) %>% \n  kable(format = \"html\") %>%\n  kable_styling(bootstrap_options = \"basic\", full_width = F, position = \"float_left\")  %>%\n  column_spec(7, bold = TRUE, color = \"black\", background = \"#eeeeee\")"},{"path":"statistical-significance-analysis.html","id":"core-taxa-multivariate-anova","chapter":"3 Statistical Significance Analysis","heading":"3.6 Core taxa multivariate ANOVA","text":"","code":"\nps_core %>% \nbetatest(group = c(\"nationality\", \"bmi_group\"), distance = \"bray\") %>%\n  set_colnames(c(\"Group\", \"Df\", \"SumsOfSqs\", \"MeanSqs\", \"FModel\", \"R2\", \"Pvalue\")) %>% \n  kable(format = \"html\") %>%\n  kable_styling(bootstrap_options = \"basic\", full_width = F, position = \"float_left\")  %>%\n  column_spec(7, bold = TRUE, color = \"black\", background = \"#eeeeee\")"},{"path":"statistical-significance-analysis.html","id":"diff_abund","chapter":"3 Statistical Significance Analysis","heading":"3.7 Differential abundance Analysis","text":"Perform differential abundance analysis identify features show statistically significant differences abundance groups.analysis allow researchers determine features associated studied conditions factors.Statistical tests, t-tests, Wilcoxon rank-sum tests, analysis variance (ANOVA) can help assessing significance differences determine beyond expected chance.","code":""},{"path":"statistical-significance-analysis.html","id":"testing-with-deseq2-tool","chapter":"3 Statistical Significance Analysis","heading":"3.7.1 Testing with DESeq2 tool","text":"\n(#tab:diffabund_table)Differential abundance results\n","code":"\nlibrary(tidyverse)\nlibrary(ggtext)\n\ndifftest <- difftest(ps_raw, group=\"nationality\")\n\ndifftest %>%\n  select(log2FoldChange, pvalue, padj, Significant) %>%\n  filter(Significant == \"Yes\") %>%\n  filter(padj <= 0.05) %>%\n  head(10) %>%\n  kbl(caption = \"Differential abundance results\") %>%\n  kable_styling(bootstrap_options = \"basic\", full_width = F, position = \"float_left\")\n### Differential abundance plot\n\nlibrary(dplyr)\nlibrary(microbial)\n\ndifftest_w_meta <- difftest %>%\n  rename_all(~ make.unique(tolower(.), sep = \"_\")) %>%\n  tibble::rownames_to_column(\"otu\") %>%\n  inner_join(., psmelt(ps_raw), by = c(\"otu\" = \"OTU\")) %>%\n  relocate(c(nationality, bmi_group), .after = otu) %>%\n  mutate(nationality = factor(nationality,\n                      levels = c(\"AAM\", \"AFR\"),\n                      labels = c(\"African American\", \"African\")),\n         bmi_group = factor(bmi_group,\n                      levels = c(\"lean\", \"overweight\", \"obese\"),\n                      labels = c(\"Lean\", \"Overweight\", \"Obese\"))) %>%\n  rename_all(~ make.unique(tolower(.), sep = \"_\")) %>%\n  select(-phylum_1, -family_1, -genus_1) %>%\n  distinct(otu, .keep_all = TRUE) %>%\n  pivot_longer(cols = c(\"phylum\", \"family\", \"genus\"), names_to = \"level\", values_to = \"taxon\") %>%\n  mutate(taxon = str_replace(string = taxon,\n                            pattern = \"(.*)\",\n                            replacement = \"*\\\\1*\"),\n        taxon = str_replace(string = taxon,\n                            pattern = \"\\\\*(.*)_unclassified\\\\*\",\n                            replacement = \"Unclassified<br>*\\\\1*\"),\n        taxon = str_replace_all(taxon, \"_\", \" \")) %>%\n  filter(padj <= 0.0001) %>%\n  filter(level == \"genus\")\n\ndifftest_w_meta %>%\n  ggplot(aes(y = reorder(taxon, log2foldchange), x = log2foldchange, fill = nationality)) +\n  geom_col() +\n  theme_light() +\n  labs(x = \"Log2 Fold Change\", y = \"\", fill = NULL, subtitle = \"Differential abundance by nationality\") +\n  theme(axis.text.y = element_markdown(size = 7),\n        legend.text = element_markdown(size = 7)) +\n  coord_cartesian(xlim = c(-3, 4))\ndifftest_w_meta %>%\n  ggplot(aes(y = reorder(taxon, log2foldchange), x = log2foldchange, fill = bmi_group)) +\n  geom_col() +\n  theme_light() +\n  labs(x = \"Log2 Fold Change\", y = \"\", fill = NULL, subtitle = \"Differential abundance by BMI\") +\n  theme(axis.text.y = element_markdown(size = 7),\n        legend.text = element_markdown(size = 7)) +\n  coord_cartesian(xlim = c(-3, 4))\nsave(difftest_w_meta, file = \"data/difftest_w_meta.rda\")"},{"path":"statistical-significance-analysis.html","id":"biomarker-discovery","chapter":"3 Statistical Significance Analysis","heading":"3.8 Biomarker Discovery","text":"Biomarker discovery aims identify distinct markers indicators offer valuable insights health disease. identified biomarkers provide crucial information regarding various aspects. Employing machine learning techniques, random forest classification, can enhance understanding providing -depth insights, including:Facilitating disease diagnosisMonitoring evaluating treatment responsesImproving comprehension underlying biological processesEnabling prediction outcomes.","code":""},{"path":"statistical-significance-analysis.html","id":"microbial-pkg-markers","chapter":"3 Statistical Significance Analysis","heading":"3.8.1 Biomarkers using microbial package","text":"Microbial R package performms Random Forest Classification computes Confusion Matrix means evaluating model’s performance.biomarker discovery techniques next sections underMicrobial Machine Learning.","code":"\nlibrary(microbial)\n\nbiomarker(ps_raw, group = \"nationality\", ntree = 129) %>%\nplotmarker(level=\"Genus\") +\n  coord_flip() +\n  theme_test() +\n  labs(x = NULL)\nCall:\n randomForest(formula = group ~ ., data = data, importance = TRUE,      proximity = TRUE, ntree = ntree) \n               Type of random forest: classification\n                     Number of trees: 129\nNo. of variables tried at each split: 8\n\n        OOB estimate of  error rate: 4.5%\nConfusion matrix:\n    AAM AFR class.error\nAAM 119   4  0.03252033\nAFR   6  93  0.06060606"},{"path":"imap-github-repos.html","id":"imap-github-repos","chapter":"A IMAP GitHub Repos","heading":"A IMAP GitHub Repos","text":"","code":""},{"path":"read-qc-rulegraph.html","id":"read-qc-rulegraph","chapter":"B Read QC Rulegraph","heading":"B Read QC Rulegraph","text":"","code":""},{"path":"session-information.html","id":"session-information","chapter":"C Session Information","heading":"C Session Information","text":"Reproducibility relies ability precisely recreate working environment, session information serves vital reference achieve consistency. record details R environment, package versions, system settings computing environment time analysis.","code":"\nlibrary(sessioninfo)\n\n# Get session info\ninfo <- capture.output(print(session_info()))\n\n# Define patterns to exclude\nexclude_patterns <- c(\"/Users/.*\", \"Africa/Dar_es_Salaam\") # This line is location-dependent\n\n# Exclude lines containing specific information\ninfo_filtered <- info[!grepl(paste(exclude_patterns, collapse = \"|\"), info)]\n\n# Save the filtered session info to a text file in the root directory without line numbers\ncat(info_filtered, file = \"session_info.txt\", sep = \"\\n\")"},{"path":"references.html","id":"references","chapter":"References","heading":"References","text":"","code":""}]
